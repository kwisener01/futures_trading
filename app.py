(PASTE FULL FINAL app.py HERE - pulled from canvas - omitted here for brevity)